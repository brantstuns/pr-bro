#!/usr/bin/perl
use strict;

chomp(my $current_branch = `git rev-parse --abbrev-ref HEAD`);
my $test_command = "gulp specs";

if ($current_branch eq "master") {
    print "\n(ಠ_ಠ) (ಠ_ಠ) (ಠ_ಠ) (ಠ_ಠ) (ಠ_ಠ) (ಠ_ಠ) \n\n";
    print "You're on the master branch, bro. Pump the brakes and make a new branch \n\n";
    print "Enter the name of your new branch or bail by blasting ctrl-c : ";
    chomp(my $new_branch = <STDIN>);
    &make_new_branch($new_branch);
}

print "\nHey, bro. Lets make a PR. \n\nFirst lets run those specs and push to this nice remote branch you got here\n\n\n";
print "your current branch is: $current_branch\n";
&run_specs_and_push();

sub run_specs_and_push {
    system("echo $test_command") == 0
        or die "\n\nLooks like your tests are hosed, bro. \nYou should check that out before you make this sweet pull request.\n";

    system("echo git push -u origin $current_branch") == 0
        or die "\n ¯\_(ツ)_/¯ Well something not very chill is going on here. Your push blew up ¯\_(ツ)_/¯\n";
}

sub make_new_branch {
    my @git_status = `git status`;

    if (chomp($git_status[2]) eq "nothing to commit, working tree clean") {
        die "Looks like you already commited to master or you just don't have any local changes.
        The pr-bro can't help you now.
        This can though: \n\n http://bfy.tw/8PTQ\n"
    } else {
        system("git checkout -b $_[0]") == 0
            or die "\n ¯\_(ツ)_/¯ Well something not very chill is going on here.
                    Your new branch checkout blew up ¯\_(ツ)_/¯\n";
    }
}